<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Sensor Dashboard — RealtimeDB</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;padding:18px}
    table{border-collapse:collapse;width:100%;max-width:1100px}
    th,td{border:1px solid #ddd;padding:8px;text-align:left}
    th{background:#f4f4f4}
    img.thumb{max-width:160px;max-height:120px;object-fit:cover}
    .muted{color:#666;font-size:0.9rem}
  </style>
</head>
<body>
  <h1>Raspberry Pi Sensor Readings</h1>
  <p class="muted">Realtime Database viewer — updates automatically.</p>

  <table id="tbl" aria-live="polite">
    <thead><tr><th>Device ID</th><th>Humidity</th><th>Image</th><th>Light</th><th>Temperature</th></tr></thead>
    <tbody></tbody>
  </table>

  <script type="module">

    // ======== Firebase Config (IMPORTANT: corrected databaseURL) ========
    const firebaseConfig = {
      apiKey: "AIzaSyA6sbgEfeTBvT_zQbdJtErAzK_8s7rcUoU",
      authDomain: "myproject-d8e61.firebaseapp.com",
      projectId: "myproject-d8e61",
      storageBucket: "myproject-d8e61.firebasestorage.app",
      messagingSenderId: "270167245798",
      appId: "1:270167245798:web:b38511a3b10deaf5d9cc27",
      measurementId: "G-LJ40CBFL0Q",
      databaseURL: "https://myproject-d8e61-default-rtdb.firebaseio.com/"
    };
    // ====================================================================

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.30.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.30.0/firebase-database.js";

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Your JSON path:  https://myproject.../sensors.json
    const ROOT_PATH = "sensors";

    const tbody = document.querySelector("#tbl tbody");

    function render(dataObj) {
      tbody.innerHTML = "";
      if (!dataObj) {
        tbody.innerHTML = "<tr><td colspan='5'>No data found.</td></tr>";
        return;
      }

      Object.entries(dataObj).forEach(([id, row]) => {
        const imgHtml = row.ImageURL ? `<img class="thumb" src="${row.ImageURL}" alt="${id}">` : "";

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${escapeHtml(id)}</td>
          <td>${escapeHtml(row.Humidity ?? "")}</td>
          <td>${imgHtml}</td>
          <td>${escapeHtml(row.Light_Intensity ?? row.Light ?? "")}</td>
          <td>${escapeHtml(row.temperature ?? row.Temperature ?? "")}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Realtime listener
    const rootRef = ref(db, ROOT_PATH);
    onValue(
      rootRef,
      snap => render(snap.val()),
      err => {
        tbody.innerHTML = `<tr><td colspan="5">Error: ${escapeHtml(err.message)}</td></tr>`;
        console.error(err);
      }
    );

    function escapeHtml(s) {
      return String(s)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;");
    }
  </script>
</body>
</html>
